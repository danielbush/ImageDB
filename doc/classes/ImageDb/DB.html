<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: ImageDb::DB</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">ImageDb::DB</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/image_db/db_rb.html">
                lib/image_db/db.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>Image <a href="DB.html">DB</a></h1>
<p>
<a href="../ImageDb.html">ImageDb</a> is a simple ruby-based client or API
for accessing and using an <a href="DB.html#M000017">image</a> database.
</p>
<p>
Its primary purpose is to make handling different sized versions of the
same <a href="DB.html#M000017">image</a> as easy as possible.
</p>
<h2>Features</h2>
<ul>
<li>the <a href="DB.html#M000017">image</a> databse (db) is filesystem-based
(ie hierarchical)

</li>
<li>the db has a root directory

</li>
<li><a href="DB.html#M000016">images</a> are stored as normal files under the
root directory in various folders

</li>
<li>multiple copies of the <a href="DB.html#M000017">image</a> can be retrieved
and stored based on differences in width or height

</li>
<li>sized <a href="DB.html#M000016">images</a> can be autogenerated

</li>
<li>the db does not handle or is not aware of <a
href="DB.html#M000017">image</a> ppi

</li>
<li>the intention is to use it to <a href="DB.html#M000011">store</a> web-ready
<a href="DB.html#M000016">images</a> which are usually 72-96 ppi and to be
accessed from a web framework such as rails

</li>
<li>the db treats an <a href="DB.html#M000017">image</a> with same name other
than its format (.png,.jpg etc) as a different <a
href="DB.html#M000017">image</a>

</li>
<li>dimensions are always specified in pixels

</li>
<li>names in the db should probably be composed of letters, numbers, hyphens
and underscores

</li>
</ul>
<h3>Original vs Sized Images</h3>
<ul>
<li>the db &quot;thinks&quot; of an <a href="DB.html#M000017">image</a> as a
set of <a href="DB.html#M000016">images</a> where each member in that set,
whilst depicting the same thing, is different in dimension. There are 2
parts to the model:

<ul>
<li>original <a href="DB.html#M000017">image</a> - this is the original <a
href="DB.html#M000017">image</a> that you <a
href="DB.html#M000011">store</a> in the db.

</li>
<li>sized/derivative <a href="DB.html#M000016">images</a> - these are <a
href="DB.html#M000016">images</a> generated off of the original <a
href="DB.html#M000017">image</a>; <a href="DB.html">DB</a> makes it fairly
easy to do this

</li>
</ul>
</li>
<li>if you have lots of <a href="DB.html#M000016">images</a> with the same name
but depicting something different, consider prepending a category into the
name like so:

<pre>
  imageA.png =&gt; cat1-imageA.png
             =&gt; cat2-imageA.png
</pre>
</li>
</ul>
<h3>Groups</h3>
<ul>
<li>you can optionally specify a group name when storing an <a
href="DB.html#M000017">image</a>

<ul>
<li>this creates a group within the db

</li>
<li>the group is a <a href="DB.html#M000008">new</a> db and corresponds to a
subdirectory of the parent db

</li>
<li>when retrieving an <a href="DB.html#M000017">image</a> from a group you
will need to specify the group name (see further down)

</li>
</ul>
</li>
</ul>
<h3>Autogeneration of sized <a href="DB.html#M000016">images</a></h3>
<ul>
<li>if you <a href="DB.html#M000013">fetch</a> an <a
href="DB.html#M000017">image</a> which exists but not at the specified
dimension, the db will automatically create it for you unless you specify
not to

</li>
</ul>
<h3>Hooks</h3>
<ul>
<li>hooks are called during major operations; this might allow you to <a
href="DB.html#M000014">update</a> your database etc

<ul>
<li>if the hook fails, the operation is NOT rolled back

</li>
<li>if the operation fails, the hook will probably not get called

</li>
<li>this behaviour will be considered if ImageDB matures; remember that ImageDB
is just an experiment - a simple wrapper around a file system

</li>
</ul>
</li>
</ul>
<h3><a href="../ImageDb.html">ImageDb</a> FORMAT</h3>
<ul>
<li>the format of the filesystem under the root directory is straightforward
and easy to navigate manually

</li>
<li>the <a href="DB.html#M000017">image</a> you <a
href="DB.html#M000011">store</a> is copied to an originals section so you
can use it to resize

<pre>
  root := /path/to/root  # Location of db in filesystem
  DB := [root]/originals/[name]  # Original image files
              /groups/[group]    # Groups for sub-db's
              /w/[width]/[name]  # Width-resized images
              /h/[height]/[name] # Height-resized images
  group := [group-name]/[DB]     # Recursive DB
</pre>
</li>
</ul>
<p>
In other words:
</p>
<ul>
<li>your <a href="DB.html#M000017">image</a> db is at /path/to/root

</li>
<li>original <a href="DB.html#M000016">images</a> are stored in
originals/[name]

</li>
<li><a href="DB.html#M000016">images</a> resized according to width are stored
in w/[width]/[name]

</li>
<li><a href="DB.html#M000016">images</a> resized according to height are stored
in h/[height]/[name]

</li>
<li><a href="DB.html#M000019">groups</a> are stored in <a
href="DB.html#M000019">groups</a>/

</li>
<li>an group is defined like the above where root is now <a
href="DB.html#M000019">groups</a>/[group-name]

</li>
</ul>
<h2>USAGE:</h2>
<ul>
<li>the db will raise an error if you try to <a
href="DB.html#M000011">store</a> an <a href="DB.html#M000017">image</a>
with the same name unless you specify a force option

<ul>
<li>this is to prevent possibility of having you load a different depiction
into the db

</li>
<li>if you do force, consider updating resized <a
href="DB.html#M000016">images</a>

</li>
</ul>
</li>
<li>the db will return nil if you try to <a href="DB.html#M000013">fetch</a> an
<a href="DB.html#M000017">image</a> that doesn&#8216;t exist

</li>
<li>the extension of the file name (.jpg,.png) is considered part of the name
so it must be included in all relevant operations

</li>
</ul>
<h3>STARTING</h3>
<pre>
  name = '/path/to/root'
  db = ImageDb::DB.new(name)
</pre>
<h3>STORING</h3>
<pre>
  db.store('/path/to/image.jpg')
    =&gt; &quot;/db-root/path/to/image.jpg&quot;  # Path will be in db.root.
    =&gt; error if exists
  db.store('/path/to/image.jpg',:force =&gt; true)
    =&gt; &quot;/db-root/path/to/name&quot; # Overrides existing
  db['group1'].store('/path/to/image.jpg')
    =&gt; &quot;/db-root/path/to/groups/group1/image.jpg&quot;
</pre>
<h3>FETCHING</h3>
<ul>
<li>Fetch an <a href="DB.html#M000017">image</a> (original or sized) from the
db

</li>
<li>&#8216;name&#8217; is the <a href="DB.html#M000017">image</a> name; do not
include any path

</li>
<li>if a sized <a href="DB.html#M000017">image</a> being fetched doesn&#8216;t
exist it will be autogenerated

</li>
<li>Fetching retrieves a string of the file path

<pre>
  db.fetch(name)
    =&gt; fetches original image
    =&gt; nil if not there
    =&gt; &quot;/db.root/path/to/image&quot;

  db.fetch(name,:width =&gt; 60)
  db.fetch(name,:height =&gt; 60)
    =&gt; fetches sized image; autogenerates it if necessary
    =&gt; &quot;/db.root/path/to/w/60/image&quot;

  db.fetch(name,:height =&gt; 60,:exists =&gt; true)
    =&gt; Don't autogenerate if image doesn't exist

  db['group1'].fetch(name,:width =&gt; 60)
    =&gt; Fetch image from group1
    =&gt; nil if image or group don't exist
</pre>
</li>
</ul>
<h3>NOT FOUND IMAGES</h3>
<ul>
<li>Set DB#use_not_found=true

</li>
<li>You can specify a not found <a href="DB.html#M000017">image</a> to use when
fetching <a href="DB.html#M000016">images</a> that don&#8216;t exist
(instead of returning nil)

</li>
<li>You can also specify a not found <a href="DB.html#M000017">image</a> as a
param option when fetching an <a href="DB.html#M000017">image</a>

</li>
<li>Your not-found <a href="DB.html#M000017">image</a> should be an existing <a
href="DB.html#M000017">image</a> in the db and will be auto-resized as
required (like other <a href="DB.html#M000016">images</a>)

</li>
</ul>
<h3>RESOLVING</h3>
<ul>
<li>Often, the db&#8216;s root is exposed via http.

</li>
<li>In these cases, you might want the db to return a file location relative to
the http server&#8216;s public root or alias.

<ul>
<li>your alias or server root should point to the actual root of the db

</li>
</ul>
</li>
<li>specify the resolving root as a second argument when creating db

<pre>
  root = '/var/www/site1/public/images/db'
  rel_root = '/images/db'
  db = ImageDb::DB.new(root,rel_root)
  ...

  src = db.fetch(image_name)
     =&gt; '/images/db/.../image-1.jpg'
  src = db.fetch(image_name,:absolute =&gt; true)
     =&gt; '/var/www/.../image-1.jpg'
</pre>
</li>
</ul>
<h3>UPDATING</h3>
<ul>
<li>Force all sized <a href="DB.html#M000016">images</a> to be recreated from
the original <a href="DB.html#M000017">image</a> (fetching will only
autogenerate, not regenerate)

<pre>
  db.update(name)
    =&gt; updates all sized images of the original

  db.update(name,:width =&gt; w)
  db.update(name,:height =&gt; h)
    =&gt; resize particular width or height
</pre>
</li>
</ul>
<h3>DELETING</h3>
<ul>
<li>Manually <a href="DB.html#M000015">delete</a> but beware if there are other
systems relying on <a href="DB.html#M000017">image</a> db

</li>
<li>Or, use the api:

<pre>
  db.delete(name)
  db['group1'].delete(name)
    =&gt; nil
</pre>
</li>
</ul>
<h3>LISTING</h3>
<ul>
<li>Listing is useful when you want to display several or all <a
href="DB.html#M000016">images</a> in the db

</li>
<li>List all original <a href="DB.html#M000016">images</a> excluding <a
href="DB.html#M000019">groups</a>

<pre>
  db.images =&gt; ['/path/to/image1',...]
</pre>
</li>
<li>List all <a href="DB.html#M000016">images</a> belonging to name - including
all sizes

<ul>
<li>Used internally to <a href="DB.html#M000015">delete</a> an <a
href="DB.html#M000017">image</a> from the db

</li>
<li>the original is always listed first

<p>
original,*others = db.image(name) =&gt;
[&#8217;/path/to/image1&#8217;,&#8230;]
</p>
</li>
</ul>
</li>
<li>If you want to see all <a href="DB.html#M000016">images</a> of a certain
size

<pre>
  db.all(:width =&gt; 300)
    =&gt; ['/path/to/w/300/image1',...]

  db['group1'].all(:width =&gt; 300)
    =&gt; ['/path/to/w/300/image1',...]
</pre>
</li>
<li>List all original <a href="DB.html#M000016">images</a> in a group

<pre>
  db['group1'].images =&gt; ['/path/to/image1',...]
</pre>
</li>
<li>List all <a href="DB.html#M000019">groups</a>

<pre>
  db.groups =&gt; ['group1',...]
</pre>
</li>
</ul>
<h3>HOOKS</h3>
<ul>
<li>Hooks are intended to allows you to be notified when a change is made to an
<a href="DB.html#M000017">image</a> in the db

<ul>
<li>original <a href="DB.html#M000017">image</a> is created

</li>
<li>original <a href="DB.html#M000017">image</a> is replaced by a <a
href="DB.html#M000008">new</a> one using the :force option with &#8216;<a
href="DB.html#M000011">store</a>&#8216;

</li>
<li>existing <a href="DB.html#M000017">image</a> is modified

</li>
<li>a fetched <a href="DB.html#M000017">image</a> is autogenerated

</li>
</ul>
</li>
<li>You have to create an object that responds to the supported hooks to be
executed

</li>
<li>Pass this in to <a href="DB.html#M000017">image</a> db when you start it

</li>
<li>methods on this object will be passed relevant information pertaining to
the event

</li>
<li>supported hooks

<ul>
<li>create

<ul>
<li>params

<ul>
<li>:force =&gt; true|nil

</li>
<li>:original =&gt; &#8217;/path/to/file&#8216;

</li>
<li>:sized =&gt; &#8217;/path/to/.../file&#8217; or
[&#8217;/path/to/.../file&#8217;,&#8230;]

<ul>
<li>if not given, then a sized <a href="DB.html#M000017">image</a> was not
created

</li>
</ul>
</li>
<li>:autogenerated =&gt; true|false

<ul>
<li>only added if :sized is

</li>
</ul>
</li>
<li>:width|:height =&gt; 300

<ul>
<li>only added if :sized is

</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="DB.html#M000015">delete</a>

<ul>
<li>params

<ul>
<li>:original =&gt; &#8217;/path/to/file&#8216;

</li>
<li>:sized =&gt; &#8230; or [&#8230;]

</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>
Example:
</p>
<pre>
  class ImageDBHooks
    def create params
      ...
    end
    ...
  end
  db = ImageDb::DB.new('/path/to/root')
  db.hooks = ImageDBHooks.new
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000020">[]</a>&nbsp;&nbsp;
      <a href="#M000010">absolute</a>&nbsp;&nbsp;
      <a href="#M000015">delete</a>&nbsp;&nbsp;
      <a href="#M000013">fetch</a>&nbsp;&nbsp;
      <a href="#M000018">glob</a>&nbsp;&nbsp;
      <a href="#M000019">groups</a>&nbsp;&nbsp;
      <a href="#M000017">image</a>&nbsp;&nbsp;
      <a href="#M000016">images</a>&nbsp;&nbsp;
      <a href="#M000008">new</a>&nbsp;&nbsp;
      <a href="#M000007">not_found_image</a>&nbsp;&nbsp;
      <a href="#M000012">rename</a>&nbsp;&nbsp;
      <a href="#M000009">resolve</a>&nbsp;&nbsp;
      <a href="#M000011">store</a>&nbsp;&nbsp;
      <a href="#M000014">update</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">hooks</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">not_found_image</td>
          <td class="context-item-value">&nbsp;[W]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">originals</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">parent_db</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rel_root</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">root</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">use_not_found</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(root,rel_root=nil,parent_db=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 298</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">root</span>,<span class="ruby-identifier">rel_root</span>=<span class="ruby-keyword kw">nil</span>,<span class="ruby-identifier">parent_db</span>=<span class="ruby-keyword kw">nil</span>
      <span class="ruby-ivar">@root</span> = <span class="ruby-identifier">root</span>
      <span class="ruby-ivar">@rel_root</span> = <span class="ruby-identifier">rel_root</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">root</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">rel_root</span>
      <span class="ruby-ivar">@mutex</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-ivar">@hooks</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-ivar">@parent_db</span> = <span class="ruby-identifier">parent_db</span>
      <span class="ruby-ivar">@not_found_image</span> = <span class="ruby-keyword kw">nil</span>

      <span class="ruby-comment cmt"># Stores groups which are instances of DB</span>
      <span class="ruby-ivar">@groups</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>

      <span class="ruby-comment cmt"># Make root if it doesn't exist</span>
      <span class="ruby-ivar">@originals</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@root</span>,<span class="ruby-value str">'originals'</span>)
      <span class="ruby-ivar">@w</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@root</span>,<span class="ruby-value str">'w'</span>)
      <span class="ruby-ivar">@h</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@root</span>,<span class="ruby-value str">'h'</span>)

      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@originals</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@w</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@h</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">[]</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Access a group to perform <a href="DB.html">DB</a> operations on that
group.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 641</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span> <span class="ruby-identifier">name</span>
      <span class="ruby-ivar">@groups</span> <span class="ruby-operator">||=</span> {}
      <span class="ruby-identifier">root</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@root</span>,<span class="ruby-value str">'groups'</span>,<span class="ruby-identifier">name</span>)
      <span class="ruby-identifier">rel_root</span> = <span class="ruby-ivar">@rel_root</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">root</span> <span class="ruby-operator">:</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@rel_root</span>,<span class="ruby-value str">'groups'</span>,<span class="ruby-identifier">name</span>)
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">root</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@groups</span>[<span class="ruby-identifier">name</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@groups</span>[<span class="ruby-identifier">name</span>]
      <span class="ruby-identifier">db</span> = <span class="ruby-constant">DB</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">root</span>,<span class="ruby-identifier">rel_root</span>,<span class="ruby-keyword kw">self</span>)
      <span class="ruby-identifier">db</span>.<span class="ruby-identifier">use_not_found</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">use_not_found</span>
      <span class="ruby-keyword kw">return</span> (<span class="ruby-ivar">@groups</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">db</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">absolute</span><span class="method-args">(nm,params=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Resolve names absolutely using root not rel_root. A string location is
always returned.
</p>
<ul>
<li>Useful for performing real filesystem operations

</li>
<li>See <a href="DB.html#M000009">resolve</a>

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 354</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">absolute</span> <span class="ruby-identifier">nm</span>,<span class="ruby-identifier">params</span>=<span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">n</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">||=</span> {}
      <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:absolute</span>] = <span class="ruby-keyword kw">true</span>
      <span class="ruby-identifier">n</span> = <span class="ruby-identifier">resolve</span> <span class="ruby-identifier">nm</span>,<span class="ruby-identifier">params</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">n</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">delete</span><span class="method-args">(name,params=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Delete original and all its derivatives or if params are given, <a
href="DB.html#M000015">delete</a> a selected sized <a
href="DB.html#M000017">image</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 531</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span> <span class="ruby-identifier">name</span>,<span class="ruby-identifier">params</span>=<span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">images</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">image</span>(<span class="ruby-identifier">name</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">o</span> = <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">images</span>[<span class="ruby-identifier">:original</span>])

      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">o</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">o</span>)
        [<span class="ruby-identifier">:widths</span>,<span class="ruby-identifier">:heights</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">images</span>[<span class="ruby-identifier">w</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
            <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">name</span>,
                                 (<span class="ruby-identifier">w</span><span class="ruby-operator">==</span><span class="ruby-identifier">:widths</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">:width</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:height</span>) =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>))
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-ivar">@hooks</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:original</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">images</span>[<span class="ruby-identifier">:original</span>],
                      <span class="ruby-identifier">:sized</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">images</span>[<span class="ruby-identifier">:widths</span>]<span class="ruby-operator">+</span><span class="ruby-identifier">images</span>[<span class="ruby-identifier">:heights</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@hooks</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">o</span>

      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">w</span>,<span class="ruby-identifier">h</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:width</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:height</span>]
        <span class="ruby-identifier">n</span> = <span class="ruby-keyword kw">nil</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">w</span>
          <span class="ruby-identifier">n</span> = <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">w</span>)
          <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">n</span>)
          <span class="ruby-ivar">@hooks</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:sized</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">n</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@hooks</span>
        <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">h</span>
          <span class="ruby-identifier">n</span> = <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">h</span>)
          <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">n</span>)
          <span class="ruby-ivar">@hooks</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:sized</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">n</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@hooks</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">raise</span> <span class="ruby-value str">'Error #2 '</span><span class="ruby-operator">+</span><span class="ruby-ivar">@@errors</span>[<span class="ruby-value">2</span>]
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">n</span>

      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">fetch</span><span class="method-args">(name,params=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Fetch an <a href="DB.html#M000017">image</a> (original or sized)
</p>
<p>
Returns string location of <a href="DB.html#M000017">image</a> or nil if
the original does not exist in the db. If you are fetching a sized <a
href="DB.html#M000017">image</a> of an existing original which
doesn&#8216;t exist, it will be autogenerated from the original.
</p>
<h2>Params</h2>
<ul>
<li>width or height: specify desired width or height of <a
href="DB.html#M000017">image</a>.

<pre>
                 Omitting this will return the original.
</pre>
</li>
<li><a href="DB.html#M000010">absolute</a>: return the file path; do not <a
href="DB.html#M000009">resolve</a> to rel_root

</li>
<li>not_found: specify a not_found <a href="DB.html#M000017">image</a>; in
general set this using

<pre>
           DB#not_found_image but override here if you want to
</pre>
</li>
<li>exists: do not autogenerate <a href="DB.html#M000017">image</a>; this is
how to test for existence

</li>
<li>skiphook: skip running creation hook

</li>
<li><a href="DB.html#M000014">update</a>: force <a
href="DB.html#M000017">image</a> generation even if it exists; used by
&#8216;<a href="DB.html#M000014">update</a>&#8216;

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 427</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fetch</span> <span class="ruby-identifier">name</span>,<span class="ruby-identifier">params</span>=<span class="ruby-keyword kw">nil</span>

      <span class="ruby-identifier">o</span> = <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">name</span>) <span class="ruby-comment cmt"># Original</span>
      <span class="ruby-identifier">n</span> = <span class="ruby-keyword kw">nil</span>

      <span class="ruby-comment cmt"># Find not_found image...</span>
      <span class="ruby-identifier">nf</span> = (<span class="ruby-identifier">params</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:not_found</span>) <span class="ruby-operator">?</span>
                     <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:not_found</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">not_found_image</span>)

      <span class="ruby-comment cmt"># Original doesn't exist, use nf...</span>

      <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">o</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">use_not_found</span>
        <span class="ruby-identifier">name</span> = <span class="ruby-identifier">nf</span>
        <span class="ruby-identifier">o</span> = <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">name</span>)
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span>

      <span class="ruby-comment cmt"># Fetch original...</span>

      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">o</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;fetch: Invalid options&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:width</span>) <span class="ruby-operator">&amp;&amp;</span>
        <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:height</span>) <span class="ruby-operator">&amp;&amp;</span>
        <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:absolute</span>) <span class="ruby-operator">&amp;&amp;</span>
        <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:not_found</span>)

      <span class="ruby-identifier">n</span> = <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">params</span>) <span class="ruby-comment cmt"># Sized or original</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">n</span>)

      <span class="ruby-comment cmt"># Autogenerate/regenerate/do-nothing on sized image (n)</span>
      <span class="ruby-comment cmt"># depending on settings...</span>

      <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">n</span>)
        <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:update</span>]
          <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">params</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:absolute</span>]
          <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">params</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:exists</span>]<span class="ruby-operator">==</span><span class="ruby-keyword kw">true</span>
          <span class="ruby-comment cmt"># Slightly ugly.  We have an original, but this size</span>
          <span class="ruby-comment cmt"># doesn't exist.  We revert back to the not found image.</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">use_not_found</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">nf</span>,<span class="ruby-identifier">params</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:absolute</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">nf</span>,<span class="ruby-identifier">params</span>)
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">autogenerated</span> = <span class="ruby-keyword kw">true</span>
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-identifier">i</span> = <span class="ruby-constant">Image</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">o</span>)
      <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:to</span>] = <span class="ruby-identifier">n</span>
      <span class="ruby-identifier">i</span>.<span class="ruby-identifier">out</span> <span class="ruby-identifier">params</span>
      <span class="ruby-ivar">@hooks</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:original</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">o</span>,
                    <span class="ruby-identifier">:sized</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">n</span>,
                    <span class="ruby-identifier">:autogenerated</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">autogenerated</span>,
                    <span class="ruby-identifier">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:width</span>],
                    <span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:height</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@hooks</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:skiphook</span>]
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">params</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:absolute</span>]
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">params</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">glob</span><span class="method-args">(pattern)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Use shell wildcard style searching (simpler than regex).
</p>
<p>
Returns <a href="DB.html#M000017">image</a> name. Use <a
href="DB.html#M000013">fetch</a> to <a href="DB.html#M000013">fetch</a> it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 620</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">glob</span> <span class="ruby-identifier">pattern</span>
      <span class="ruby-constant">Dir</span>[<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@originals</span>,<span class="ruby-identifier">pattern</span>)].<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
        <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">f</span>)
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">groups</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
List <a href="DB.html#M000019">groups</a> in <a href="DB.html">DB</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 631</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">groups</span>
      <span class="ruby-identifier">g</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@root</span>,<span class="ruby-value str">'groups'</span>)
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">g</span>
      <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@root</span>,<span class="ruby-value str">'groups'</span>)) <span class="ruby-keyword kw">do</span>
        <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'*'</span>]
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">image</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
List all (sized) <a href="DB.html#M000016">images</a> for an <a
href="DB.html#M000017">image</a>. Paths are not returned so you need to use
<a href="DB.html#M000013">fetch</a>().
</p>
<p>
Returns { :original =&gt; name ,
</p>
<pre>
          :widths =&gt; [60,...] ,
          :heights =&gt; [135,...]
        }
        or nil if original doesn't exist
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 594</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">image</span> <span class="ruby-identifier">name</span>
      <span class="ruby-identifier">n</span> = <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">name</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">n</span>)
      <span class="ruby-identifier">result</span> = {}
      <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:original</span>] = <span class="ruby-identifier">name</span>
      <span class="ruby-identifier">l</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">r</span> = []
        <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">w</span>) <span class="ruby-keyword kw">do</span>
          <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'*'</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">d</span>)
              <span class="ruby-identifier">nm</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">w</span>,<span class="ruby-identifier">d</span>,<span class="ruby-identifier">name</span>)
              <span class="ruby-identifier">r</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">d</span>.<span class="ruby-identifier">to_i</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">nm</span>)
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">r</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:widths</span>] = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">call</span>(<span class="ruby-ivar">@w</span>)
      <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:heights</span>] = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">call</span>(<span class="ruby-ivar">@h</span>)
      <span class="ruby-identifier">result</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">images</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
List original <a href="DB.html#M000016">images</a> (excluding <a
href="DB.html#M000019">groups</a>). Paths are not returned so you need to
use <a href="DB.html#M000013">fetch</a>().
</p>
<p>
Returns an array. Use images.grep(/search-pattern/) to search for
originals. Also see <a href="DB.html#M000018">glob</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 577</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">images</span>
      <span class="ruby-identifier">r</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-ivar">@originals</span>) <span class="ruby-keyword kw">do</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'*'</span>]
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">r</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">not_found_image</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return <a href="DB.html#M000007">not_found_image</a> in this db or nearest
parent db.
</p>
<p>
You can override this setting using params[:not_found] in <a
href="DB.html#M000013">fetch</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 292</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">not_found_image</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@not_found_image</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@not_found_image</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent_db</span>.<span class="ruby-identifier">not_found_image</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent_db</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">rename</span><span class="method-args">(old,new,params=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Rename an <a href="DB.html#M000017">image</a> in the db to a <a
href="DB.html#M000008">new</a> name including all its sized versions.
</p>
<p>
Use params[:force]=true to force writing over an <a
href="DB.html#M000017">image</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 392</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rename</span> <span class="ruby-identifier">old</span>,<span class="ruby-identifier">new</span>,<span class="ruby-identifier">params</span>=<span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">a</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">image</span>(<span class="ruby-identifier">old</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">b</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">image</span>(<span class="ruby-identifier">new</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">b</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-value str">'Error #3 '</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@@errors</span>[<span class="ruby-value">3</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:force</span>]
        <span class="ruby-identifier">delete</span> <span class="ruby-identifier">b</span>[<span class="ruby-identifier">:original</span>]
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">store</span> <span class="ruby-identifier">absolute</span>(<span class="ruby-identifier">a</span>[<span class="ruby-identifier">:original</span>]),<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">new</span>
      <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:widths</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetch</span> <span class="ruby-identifier">new</span> , <span class="ruby-identifier">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">w</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:heights</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetch</span> <span class="ruby-identifier">new</span> , <span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">w</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">delete</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:original</span>]
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">resolve</span><span class="method-args">(nm,params=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Resolve an <a href="DB.html#M000017">image</a> name relative to root or
rel_root. A string location is always returned.
</p>
<ul>
<li>params are tested for :width or :height; only one should be supplied

</li>
<li>if params is nil, <a href="DB.html#M000009">resolve</a> the original name

</li>
<li><a href="DB.html#M000009">resolve</a> and <a
href="DB.html#M000010">absolute</a> do not care about <a
href="DB.html#M000017">image</a> existence; they are only concerned with
resolving the location of the <a href="DB.html#M000017">image</a> if it
were in the db (whether it is or not)

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 333</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">resolve</span> <span class="ruby-identifier">nm</span>,<span class="ruby-identifier">params</span>=<span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nm</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">root</span> = <span class="ruby-ivar">@root</span>
      <span class="ruby-identifier">root</span> = <span class="ruby-ivar">@rel_root</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:absolute</span>]
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">root</span>,<span class="ruby-value str">'originals'</span>,<span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">nm</span>))
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:width</span>]
        <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">root</span>,<span class="ruby-value str">'w'</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:width</span>].<span class="ruby-identifier">to_s</span>,<span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">nm</span>))
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:height</span>]
        <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">root</span>,<span class="ruby-value str">'h'</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:height</span>].<span class="ruby-identifier">to_s</span>,<span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">nm</span>))
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">root</span>,<span class="ruby-value str">'originals'</span>,<span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">nm</span>))
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">store</span><span class="method-args">(path,options=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Store an original <a href="DB.html#M000017">image</a>
</p>
<p>
This is the only way <a href="DB.html#M000008">new</a> <a
href="DB.html#M000016">images</a> can be stored in the db.
&#8216;path&#8217; should be a filepath to a real <a
href="DB.html#M000017">image</a>. You can specify an alternative <a
href="DB.html#M000017">image</a> name to the &#8216;path&#8217; using
options[:name]
</p>
<pre>
  store '/path/to/image.jpg' , :name =&gt; 'image-2.jpg'
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 375</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">store</span> <span class="ruby-identifier">path</span>,<span class="ruby-identifier">options</span>=<span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">name</span> = <span class="ruby-identifier">options</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:name</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:name</span>] <span class="ruby-operator">:</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">path</span>)
      <span class="ruby-identifier">nm</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@originals</span>,<span class="ruby-identifier">name</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">nm</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-value str">'Error #1 '</span><span class="ruby-operator">+</span><span class="ruby-ivar">@@errors</span>[<span class="ruby-value">1</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:force</span>]
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">copy</span> <span class="ruby-identifier">path</span> , <span class="ruby-identifier">nm</span>
      <span class="ruby-ivar">@hooks</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:force</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">options</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:force</span>]) ,
                    <span class="ruby-identifier">:original</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">nm</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@hooks</span>
      <span class="ruby-identifier">nm</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">update</span><span class="method-args">(name,params=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Resize or create sized versions of an <a href="DB.html#M000017">image</a>.
If params are nil, then <a href="DB.html#M000014">update</a> all sized <a
href="DB.html#M000016">images</a> for specified <a
href="DB.html#M000017">image</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
<span class="ruby-comment cmt"># File lib/image_db/db.rb, line 498</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span> <span class="ruby-identifier">name</span>,<span class="ruby-identifier">params</span>=<span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">options</span> = {
        <span class="ruby-identifier">:update</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,   <span class="ruby-comment cmt"># Force update even if it exists</span>
        <span class="ruby-identifier">:exists</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,  <span class="ruby-comment cmt"># Don't autogenerate</span>
        <span class="ruby-identifier">:skiphook</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>  <span class="ruby-comment cmt"># Don't run hooks</span>
      }

      <span class="ruby-comment cmt"># Update all sized instances of an original:</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">image</span>(<span class="ruby-identifier">name</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">original</span> = <span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">r</span>[<span class="ruby-identifier">:original</span>])
        <span class="ruby-identifier">others</span>  = <span class="ruby-identifier">r</span>[<span class="ruby-identifier">:widths</span>].<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">w</span>))}
        <span class="ruby-identifier">others</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">r</span>[<span class="ruby-identifier">:heights</span>].<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">h</span>))}
        <span class="ruby-ivar">@hooks</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:original</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original</span>,
                      <span class="ruby-identifier">:sized</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">others</span>,
                      <span class="ruby-identifier">:update</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@hooks</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">original</span>

      <span class="ruby-comment cmt"># Update single sized image:</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">nm</span> = <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>))
        <span class="ruby-ivar">@hooks</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:sized</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">nm</span>,
                      <span class="ruby-identifier">:update</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@hooks</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">nm</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>